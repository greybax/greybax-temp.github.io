---
layout: post
title: "ASP.NET: События жизненного цикла страницы"
date: 2014-05-12
comments: true
categories:
 - ASP.NET
 - programming
---

<div class='post'>
<div dir="ltr" style="text-align: left;" trbidi="on"><div style="text-align: left;"><span style="font-family: inherit;">Эта статья является продолжением статьи&nbsp;<a href="http://greybax.blogspot.ru/2014/04/aspnet.html" style="color: #3778cd;">ASP.NET: Этапы жизненного цикла страницы</a>. Сейчас я хочу более подробно рассказать о событийной модели в ASP.NET.&nbsp;<span style="line-height: 19.9999942779541px; text-align: justify;">Во время прохождения этапов жизненного цикла возникают события, подписавшись на которые, разработчик может выполнять свой собственный код. Зачастую, многие начинающие разработчики, путают порядок событий в asp.net приложении. Проверить trace загрузки страницы достаточно просто:</span></span></div><ul style="text-align: left;"><li><span style="font-family: inherit;">Создадим простое ASP.NET Web Forms Application в студии</span></li><li><span style="font-family: inherit;">Добавляем атрибуты Trace и TraceMode директивы&nbsp;@Page и устанавливаем значения 'true' и 'SortByName' соответственно.</span></li></ul><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-t8kJhuvsFzY/U2dzRQx22fI/AAAAAAAABA4/joxV8eAvuIE/s1600/Untitled.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em; text-align: center;"><span style="font-family: inherit;"><img border="0" src="http://2.bp.blogspot.com/-t8kJhuvsFzY/U2dzRQx22fI/AAAAAAAABA4/joxV8eAvuIE/s1600/Untitled.png" height="74" width="640" /></span></a><a href="http://2.bp.blogspot.com/-t8kJhuvsFzY/U2dzRQx22fI/AAAAAAAABA4/joxV8eAvuIE/s1600/Untitled.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em; text-align: center;"><span style="font-family: inherit;"><br /></span></a></div><span style="font-family: inherit;"><br /><br /><br /><br /><br /></span><br /><ul style="text-align: left;"><li><span style="font-family: inherit;">Запускаем наш сайт (нажимаем F5 в студии)</span></li><li><span style="font-family: inherit;">Прямо в окне браузера вместе с сайтом загрузилась информации трассировки.</span></li></ul><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-6tgWMi1IZHk/U2d3K3cYC7I/AAAAAAAABBE/vDJc1nhg8FU/s1600/22.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><span style="font-family: inherit;"><img border="0" src="http://4.bp.blogspot.com/-6tgWMi1IZHk/U2d3K3cYC7I/AAAAAAAABBE/vDJc1nhg8FU/s1600/22.png" height="296" width="640" /></span></a></div><div class="separator" style="clear: both; text-align: center;"></div><div style="text-align: left;"><br /><a name='more'></a>Во время трассировки не выводится событие&nbsp;<b style="line-height: 19.9999942779541px; text-align: justify;">Unload</b><span style="background-color: white; font-family: inherit; line-height: 16px;">, потому что оно происходит, когда весь код уже выведен.&nbsp;</span><span style="font-family: inherit; line-height: 19.9999942779541px; text-align: justify;">Из всех событий жизненного цикла страницы, разработчик может подписаться только на пять, помимо событий дочерних элементов управления. Эти события: <b>PreInit, Init, Load, PreRender, Unload</b>.&nbsp;</span><span style="line-height: 22.857135772705078px; text-align: justify;">Во время любого события можно использовать свойство IsPostBack, для того, чтобы определить вызвана ли эта страница в первый раз или в результате postback.&nbsp;</span><span style="font-family: inherit; line-height: 19.9999942779541px; text-align: justify;">Рассмотрим варианты использования этих событий.</span></div><div style="text-align: left;"><span style="font-family: inherit; line-height: 19.9999942779541px; text-align: justify;"><br /></span></div><table border="0" cellpadding="5" cellspacing="2" style="line-height: 1.428571em; width: 568px;"><tbody style="line-height: 1.428571em;"><tr style="line-height: 1.428571em;"><th colspan="1" rowspan="1" style="line-height: 1.428571em; padding: 0.2em 2em 0.2em 0em;"><span style="font-family: inherit;">Событие</span></th><th colspan="1" rowspan="1" style="line-height: 1.428571em; padding: 0.2em 2em 0.2em 0em;"><span style="font-family: inherit;">Использование</span></th></tr><tr style="line-height: 1.428571em;"><td align="center" colspan="1" rowspan="1" style="line-height: 1.428571em; padding: 0.2em 2em 0.2em 0em;"><strong style="line-height: 1.428571em;"><span style="font-family: inherit;">PreInit</span></strong></td><td colspan="1" rowspan="1" style="line-height: 1.428571em; padding: 0.2em 2em 0.2em 0em;"><div align="justify" style="border: 0px; line-height: 1.428571em; margin-bottom: 0.714285em; padding: 0px;"><span style="line-height: 1.428571em; text-align: left;">На данном этапе элементы управления еще не созданы и равны null. Здесь разработчик может создать динамически элементы управления, динамически устанавливать шаблон дизайна или тему оформления, считывать или устанавливать свойства объекта Profile.</span></div></td></tr><tr style="line-height: 1.428571em;"><td align="center" colspan="1" rowspan="1" style="line-height: 1.428571em; padding: 0.2em 2em 0.2em 0em;"><strong style="line-height: 1.428571em;"><span style="font-family: inherit;">Init</span></strong></td><td colspan="1" rowspan="1" style="line-height: 1.428571em; padding: 0.2em 2em 0.2em 0em;">Здесь происходит начальная инициализация контролов, значения берутся из aspx файла. Tracking ViewState еще отключен.<span style="line-height: 1.428571em;">&nbsp;В случае, если разработчик самостоятельно установит свойства на этом этапе, то на следующем установленные значения могут быть изменены</span><span style="font-family: inherit; line-height: 1.428571em;">. На этом этапе разработчик может считывать или инициализировать свойства элементов управления.</span></td></tr><tr style="line-height: 1.428571em;"><td align="center" colspan="1" rowspan="1" style="line-height: 1.428571em; padding: 0.2em 2em 0.2em 0em;"><strong style="line-height: 1.428571em;"><span style="font-family: inherit;">Load</span></strong></td><td colspan="1" rowspan="1" style="line-height: 1.428571em; padding: 0.2em 2em 0.2em 0em;"><span style="font-family: inherit;">Загружаются данные из ресурсов. Если произошел Postback, элементы управления получают значения, которые были отправлены с формы. На этом этапе разработчик может считывать или изменять свойства элементов управления.&nbsp;</span></td></tr><tr style="line-height: 1.428571em;"><td align="center" colspan="1" rowspan="1" style="line-height: 1.428571em; padding: 0.2em 2em 0.2em 0em;"><strong style="line-height: 1.428571em;"><span style="font-family: inherit;">PreRender</span></strong></td><td colspan="1" rowspan="1" style="line-height: 1.428571em; padding: 0.2em 2em 0.2em 0em;"><span style="font-family: inherit;">Последняя возможность внести изменения во внешний вид страницы.</span></td></tr><tr style="line-height: 1.428571em;"><td align="center" colspan="1" rowspan="1" style="line-height: 1.428571em; padding: 0.2em 2em 0.2em 0em;"><strong style="line-height: 1.428571em;"><span style="font-family: inherit;">Unload</span></strong></td><td colspan="1" rowspan="1" style="line-height: 1.428571em; padding: 0.2em 2em 0.2em 0em;"><span style="font-family: inherit;">Освобождение занятых ресурсов (закрытие открытых соединений с базой данных, завершение работы с файлами и т.п.)&nbsp;<span style="line-height: 1.428571em;">Важно, что на этом этапе уже создано HTML представление страницы и попытка внести какие-либо изменения (например, вызвав метод Response.Write()), приведет к исключению. Если на данном этапе изменить знамения элементов управления, они не попадут конечному пользователю.</span></span></td></tr></tbody></table><h4><span style="font-family: inherit;">Пример</span></h4><script src="https://gist.github.com/greybax/d4147fb046cf9b3cf7d3.js"></script> <br /><div class="separator" style="clear: both; text-align: center;"></div>Результат работы скрипта приведен в таблице ниже.<br /><table border="1"><tbody><tr> <td align="center" rowspan="3">Событие</td> <td align="center" colspan="8">IsPostBack</td></tr><tr> <td align="center" colspan="4">До</td> <td align="center" colspan="4">После</td></tr><tr> <td>Tracking ViewState</td> <td>TextBox (на момент входа в функцию)</td> <td>TextBox  (на момент выхода из функции)</td> <td>Response.<br />Write</td> <td>Tracking ViewState</td> <td>TextBox (на момент входа в функцию)</td> <td>TextBox (на момент выхода из функции)</td> <td>Response.<br />Write</td></tr><tr><td><b>OnPreInit</b></td><td>False</td><td>null</td><td>null</td><td>OnPreInit</td><td>False</td><td>null</td><td>null</td><td>OnPreInit</td></tr><tr><td><b>OnInit</b></td><td>False</td><td>Sample text</td><td>Sample text OnInit</td><td>OnInit</td><td>False</td><td>Sample text</td><td>Sample text OnInit</td><td>OnInit</td></tr><tr><td><b>OnPreLoad</b></td><td>True</td><td>Sample text OnInit</td><td>Sample text OnInit  OnPreLoad</td><td>OnPreLoad</td><td>True</td><td>Sample text OnInit  OnPreLoad  OnPreRender</td><td>Sample text OnInit  OnPreLoad  OnPreRender  OnPreLoad</td><td>OnPreLoad</td></tr><tr><td><b>OnPreRender</b></td><td>True</td><td>Sample text OnInit  OnPreLoad</td><td>Sample text OnInit  OnPreLoad  OnPreRender</td><td>OnPreRender</td><td>True</td><td>Sample text OnInit  OnPreLoad  OnPreRender  OnPreLoad</td><td>Sample text OnInit  OnPreLoad  OnPreRender  OnPreLoad  OnPreRender</td><td>OnPreRender</td></tr><tr><td><b>OnUnload</b></td><td>True</td><td>Sample text OnInit  OnPreLoad  OnPreRender</td><td>Sample text OnInit  OnPreLoad  OnPreRender  OnUnload</td><td>Error</td><td>True</td><td>Sample text OnInit  OnPreLoad  OnPreRender  OnPreLoad  OnPreRender</td><td>Sample text OnInit  OnPreLoad  OnPreRender  OnPreLoad  OnPreRender  OnUnload</td><td>Error</td></tr></tbody></table><br /><div><br /></div></div></div>
